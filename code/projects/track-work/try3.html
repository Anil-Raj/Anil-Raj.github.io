<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<style>
.tooltip {
    pointer-events:none; /*let mouse events pass through*/
    opacity:0;
    transition: opacity 0.3s;
    text-shadow:1px 1px 0px gray;
}
g.tooltip rect {
    fill: lightblue;
    stroke: gray;
}
rect:hover + g.tooltip{
  opacity:1;
}

</style>
</head>
<body>
<input type="file" id="selectFiles" value="Import" /><br />
<button id="import">Import Data</button><br>
  <button onclick="draw_chart()">Draw</button>
  <svg viewBox="0 0 400 300">
    <g id="circle-group" >
        <rect width="30" height="30" x="100" y="30" fill="red"/>
        <g class="tooltip" transform="translate(100,30)">
          <rect  y="-20" width="6em" height="1.25em"/>
          <text y="-20"  dy="1em" text-anchor="middle" fill="red">
            SVG/CSS Tip</text>
        </g>
    </g>
    <g id="circle-group" >
        <rect width="25" height="50" x="200" y="30" fill="red"/>
        <g class="tooltip" transform="translate(100,50)">
          <rect x="-3em" y="-45" width="6em" height="1.25em"/>
          <text y="-45" dy="1em" text-anchor="middle" fill="red">
            SVG/CSS Tip</text>
        </g>
    </g>
</svg>


<div class="mb-5 border border-gray-dark rounded-1 py-2">
<div class="js-calendar-graph is-graph-loading graph-canvas calendar-graph height-full" data-graph-url="/users/Anil-Raj/contributions" data-url="/Anil-Raj" data-from="2016-10-31" data-to="2016-11-14">
<svg id="svgOne" xmlns="http://www.w3.org/2000/svg" width="700" height="150"  class="js-calendar-graph-svg"> 
<svg id="svgTwo" xmlns="http://www.w3.org/2000/svg" width="700" height="20"  > 
</svg>

<script type="text/javascript">
Date.prototype.addDays = function(days) {
       var dat = new Date(this.valueOf())
       dat.setDate(dat.getDate() + days);
       return dat;
}
function getColor(c){
 switch(c) {
    case 0:
        return "#e3f2fd";
    case 1:
        return "#bbdefb";
    case 2:
        return "#64b5f6";
    case 3:
        return "#2196f3";
    case 4:
        return "#1e88e5";
    case 5:
        return "#1976d2";
    case 6:
        return "#1565c0";
    case 7:
        return "#0d47a1";
    default: 
        return "red";   
}
}
function n(n){
    return n > 9 ? "" + n: "0" + n;
}
Date.prototype.yyyymmdd = function() {
  var mm = this.getMonth() + 1; // getMonth() is zero-based
  var dd = this.getDate();
  return [this.getFullYear(),  n(mm),  n(dd)].join('/'); // padding
};
function getContributionCout(d){
  var data = localStorage.getItem('contribution-data');
  obj = JSON.parse(data);
  for(var i =0;i< obj.length;i++){
    if(obj[i][0]==d){
      return obj[i][1];
    }
  }
}
document.getElementById('import').onclick = function() {
    var files = document.getElementById('selectFiles').files;
  console.log(files);
  if (files.length <= 0) {
    return false;
  }
  var fr = new FileReader();
  fr.onload = function(e) { 
    var result = JSON.parse(e.target.result);
    localStorage.setItem('contribution-data', JSON.stringify(result));
  }
  fr.readAsText(files.item(0));
};

function draw_scale(){
    var svgns = "http://www.w3.org/2000/svg";
    var g = document.createElementNS(svgns,'g');
    g.setAttributeNS(null,'transform',' rotate(-90,550,120) ');
    var colorNumber=0;
    var y=120;
    while (colorNumber<=7) {
        var rect = document.createElementNS(svgns, 'rect');
        rect.setAttributeNS(null, 'x', 550);
        rect.setAttributeNS(null, 'y', y);
        rect.setAttributeNS(null, 'height', '10');
        rect.setAttributeNS(null, 'width', '10');
        rect.setAttributeNS(null, 'fill', getColor(colorNumber));
        g.appendChild(rect);
        colorNumber+=1;
        y+=12;
    }
    var gLow = document.createElementNS(svgns,'g');
    var textLow = document.createElementNS(svgns, 'text');
    textLow.setAttributeNS(null,"x", 500);
    textLow.setAttributeNS(null,"y", 120);
    textLow.textContent = "Low";
    gLow.appendChild(textLow);
    var gHigh = document.createElementNS(svgns,'g');
    var textHigh = document.createElementNS(svgns, 'text');
    textHigh.setAttributeNS(null,"x", 650);
    textHigh.setAttributeNS(null,"y", 120);
    textHigh.textContent = "High";
    gHigh.appendChild(textHigh);
    document.getElementById('svgOne').appendChild(gLow); 
    document.getElementById('svgOne').appendChild(g);
    document.getElementById('svgOne').appendChild(gHigh); 
}
function draw_chart(){
    var today = new Date();
    var startDate = new Date(today.getFullYear()-1,today.getMonth(),today.getDate());
    var x_pos;
    var y_pos;
    var svgns = "http://www.w3.org/2000/svg";
    var currentDate = startDate;
    var x=0
    for (var x=0 ; x < 53; x += 1 ) {
    var g = document.createElementNS(svgns,'g');
    g.setAttributeNS(null,'transform','translate('+x+', 0)');
    x_pos=x*12;
    for (var y = 0; y < 84 ; y += 12) {
        if(currentDate <= today){  
            var contributionCout = getContributionCout(currentDate.yyyymmdd())
            var rect = document.createElementNS(svgns, 'rect');
            rect.setAttributeNS(null, 'x', x_pos);
            rect.setAttributeNS(null, 'y', y);
            rect.setAttributeNS(null, 'height', '10');
            rect.setAttributeNS(null, 'width', '10');
            rect.setAttributeNS(null, 'fill', getColor(contributionCout));
            rect.setAttributeNS(null, 'data-count',contributionCout); 
            rect.setAttributeNS(null, 'data-date',currentDate.yyyymmdd());      
            g.appendChild(rect);
            currentDate = currentDate.addDays(1);  
        }
        else{
            break;
        }
    }
    document.getElementById('svgOne').appendChild(g);
    draw_scale();
    }
}
</script>
</body>
</html>